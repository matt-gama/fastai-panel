{% extends "base.html" %}
{% block content %}
{% if ias|length > 0 %}
<div class="dashboard-header">
    <h1>Lista de IAs</h1>
    <button class="btn-add" data-toggle="modal" data-target="#addIAModal">
        <svg class="icon" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
        </svg>
        <span>Adicionar</span>
    </button>
</div>
{% endif %}

<!-- Modal para Adicionar IA -->
<div class="modal-overlay" id="addIAModal" tabindex="-1" aria-labelledby="addIAModalLabel" aria-hidden="true">
    <div class="modal-container">
        <div class="modal-content">
            <form action="/create-ia" method="POST">
                <div class="modal-header">
                    <h3 class="modal-title" id="addIAModalLabel">Adicionar Nova IA</h3>
                    <button type="button" class="modal-close" data-dismiss="modal" aria-label="Fechar">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Nome -->
                    <div class="form-group">
                        <label for="iaName">Nome</label>
                        <input type="text" class="form-input" id="iaName" name="name" required>
                    </div>
                    <!-- Telefone -->
                    <div class="form-group">
                        <label for="iaPhone">Telefone</label>
                        <input type="text" class="form-input" id="iaPhone" name="phone_number" required>
                    </div>
                    <!-- Canal -->
                    <div class="form-group">
                        <label for="iaChannel">Canal</label>
                        <select class="form-select" id="iaChannel" name="channel" required>
                            <option value="Whatsapp">Whatsapp</option>
                        </select>
                    </div>
                    <!-- IA Usada -->
                    <div class="form-group">
                        <label for="iaUsed">IA Usada</label>
                        <select class="form-select" id="iaUsed" name="ia_used" required>
                            <option value="Openai">Openai</option>
                        </select>
                    </div>
                    <!-- API Key -->
                    <div class="form-group">
                        <label for="iaApikey">API Key</label>
                        <input type="text" class="form-input" id="iaApikey" name="apikey" required>
                    </div>
                    <!-- Modelo a ser usado -->
                    <div class="form-group">
                        <label for="iaModel">Modelo a ser usado</label>
                        <input type="text" class="form-input" id="iaModel" name="model" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="submit" class="btn-primary">Criar</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% if ias|length == 0 %}
  <div class="empty-ia-state">
    <div class="model-container">
        <!-- Modelo 3D animado -->
        <div class="robot-model">
            <div class="robot-icon">
                <svg viewBox="0 0 24 24" width="120" height="120">
                    <path fill="currentColor" d="M22,14H21C21,10.13 17.87,7 14,7H13V5.73C13.6,5.39 14,4.74 14,4C14,2.9 13.1,2 12,2C10.9,2 10,2.9 10,4C10,4.74 10.4,5.39 11,5.73V7H10C6.13,7 3,10.13 3,14H2C1.45,14 1,14.45 1,15V18C1,18.55 1.45,19 2,19H3V20C3,21.11 3.9,22 5,22H19C20.11,22 21,21.11 21,20V19H22C22.55,19 23,18.55 23,18V15C23,14.45 22.55,14 22,14M21,17H19V20H5V17H3V16H5V14C5,11.24 7.24,9 10,9H14C16.76,9 19,11.24 19,14V16H21V17M8.5,13.5C7.67,13.5 7,14.17 7,15C7,15.83 7.67,16.5 8.5,16.5C9.33,16.5 10,15.83 10,15C10,14.17 9.33,13.5 8.5,13.5M15.5,13.5C14.67,13.5 14,14.17 14,15C14,15.83 14.67,16.5 15.5,16.5C16.33,16.5 17,15.83 17,15C17,14.17 16.33,13.5 15.5,13.5Z" />
                </svg>
                <div class="shadow-element"></div>
            </div>
        </div>
    </div>
    <h2>Nenhuma IA Criada</h2>
    <p>Você ainda não possui nenhuma IA criada. Comece criando uma nova IA para expandir suas possibilidades de automação e interação.</p>
    <button class="btn-add" data-toggle="modal" data-target="#addIAModal">
      <svg class="icon" viewBox="0 0 24 24">
          <path fill="currentColor" d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" />
      </svg>
      <span>Adicionar</span>
  </button>
    
    <div class="features-grid">
        <div class="feature-item">
            <div class="feature-icon">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,16A3,3 0 0,1 9,13C9,11.88 9.61,10.9 10.5,10.39L20.21,4.77L14.68,14.35C14.18,15.33 13.17,16 12,16M12,3C13.81,3 15.5,3.5 16.97,4.32L14.87,5.53C14,5.19 13,5 12,5A8,8 0 0,0 4,13C4,15.21 4.89,17.21 6.34,18.65H6.35C6.74,19.04 6.74,19.67 6.35,20.06C5.96,20.45 5.32,20.45 4.93,20.07V20.07C3.12,18.26 2,15.76 2,13A10,10 0 0,1 12,3M22,13C22,15.76 20.88,18.26 19.07,20.07V20.07C18.68,20.45 18.05,20.45 17.66,20.06C17.27,19.67 17.27,19.04 17.66,18.65V18.65C19.11,17.2 20,15.21 20,13C20,12 19.81,11 19.46,10.1L20.67,8C21.5,9.5 22,11.18 22,13Z" />
                </svg>
            </div>
            <h3>Automação Inteligente</h3>
            <p>Crie fluxos de conversação automatizados</p>
        </div>
        <div class="feature-item">
            <div class="feature-icon">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18" />
                </svg>
            </div>
            <h3>Atendimento 24/7</h3>
            <p>Disponível para seus clientes a qualquer momento</p>
        </div>
        <div class="feature-item">
            <div class="feature-icon">
                <svg viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,4A8,8 0 0,0 4,12C4,14.09 4.8,16 6.11,17.41L9.88,9.88L17.41,6.11C16,4.8 14.09,4 12,4M12,20A8,8 0 0,0 20,12C20,9.91 19.2,8 17.89,6.59L14.12,14.12L6.59,17.89C8,19.2 9.91,20 12,20M12,12L11.23,11.23L9.7,14.3L12.77,12.77L12,12M12,17.5H13V19H12V17.5M15.88,15.89L16.59,15.18L17.65,16.24L16.94,16.95L15.88,15.89M17.5,12V11H19V12H17.5M12,6.5H11V5H12V6.5M8.12,8.11L7.41,8.82L6.35,7.76L7.06,7.05L8.12,8.11M6.5,12V13H5V12H6.5Z" />
                </svg>
            </div>
            <h3>Análise de Dados</h3>
            <p>Insights valiosos sobre suas interações</p>
        </div>
    </div>
</div>
      {% else %}
<div class="card-grid">
  
    {% for ia in ias %}
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">{{ ia.name }}</h3>
            <div class="card-actions">
                <!-- Botão de Conectar -->
                <button class="btn-icon btn-connect" data-toggle="modal" data-target="#connectModal{{ ia.id }}" onclick="loadQRCode('{{ ia.id }}', '{{ ia.name }}', false)" title="Conectar IA">
                    
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 3.75 9.375v-4.5ZM3.75 14.625c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5a1.125 1.125 0 0 1-1.125-1.125v-4.5ZM13.5 4.875c0-.621.504-1.125 1.125-1.125h4.5c.621 0 1.125.504 1.125 1.125v4.5c0 .621-.504 1.125-1.125 1.125h-4.5A1.125 1.125 0 0 1 13.5 9.375v-4.5Z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 6.75h.75v.75h-.75v-.75ZM6.75 16.5h.75v.75h-.75v-.75ZM16.5 6.75h.75v.75h-.75v-.75ZM13.5 13.5h.75v.75h-.75v-.75ZM13.5 19.5h.75v.75h-.75v-.75ZM19.5 13.5h.75v.75h-.75v-.75ZM19.5 19.5h.75v.75h-.75v-.75ZM16.5 16.5h.75v.75h-.75v-.75Z" />
                    </svg>
                </button>
                <!-- Botão de Editar -->
                <button class="btn-icon btn-edit" data-toggle="modal" data-target="#editIAModal{{ ia.id }}" title="Editar IA">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
                    </svg>
                </button>
                <!-- Botão de Deletar -->
                <button class="btn-icon btn-delete" data-toggle="modal" data-target="#deleteIAModal{{ ia.id }}" title="Deletar IA">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="card-body">
            <div class="card-info">
                <div class="info-item">
                    <span class="info-label">Telefone:</span>
                    <span class="info-value">{{ ia.phone_number }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status:</span>
                    <span class="info-value status-badge {% if ia.status %}status-active{% else %}status-inactive{% endif %}">
                        {% if ia.status %}Ativo{% else %}Inativo{% endif %}
                    </span>
                </div>
            </div>
            <div class="card-buttons">
                <button class="btn-action" data-toggle="modal" data-target="#promptModal{{ ia.id }}">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18" />
                    </svg>
                    <span>Prompt</span>
                </button>
                <a href="{{ url_for('get_leads_ia', ia_id=ia.id) }}" class="btn-action">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M16,13C15.71,13 15.38,13 15.03,13.05C16.19,13.89 17,15 17,16.5V19H23V16.5C23,14.17 18.33,13 16,13M8,13C5.67,13 1,14.17 1,16.5V19H15V16.5C15,14.17 10.33,13 8,13M8,11A3,3 0 0,0 11,8A3,3 0 0,0 8,5A3,3 0 0,0 5,8A3,3 0 0,0 8,11M16,11A3,3 0 0,0 19,8A3,3 0 0,0 16,5A3,3 0 0,0 13,8A3,3 0 0,0 16,11Z" />
                    </svg>
                    <span>Leads</span>
                </a>
            </div>
        </div>
    </div>
    
    

    <!-- Modal para Editar IA -->
<div class="modal-overlay" id="editIAModal{{ ia.id }}" tabindex="-1" aria-labelledby="editIAModalLabel{{ ia.id }}" aria-hidden="true">
  <script>
    function updateAudioProbValue{{ ia.id }}(value) {
        document.getElementById('audioProbValue{{ ia.id }}').textContent = Math.round(value);
    }
  </script>
  <div class="modal-container">
      <div class="modal-content">
          <form action="/edit-ia/{{ ia.id }}" method="POST">
              <div class="modal-header">
                  <h3 class="modal-title" id="editIAModalLabel{{ ia.id }}">Editar IA - {{ ia.name }}</h3>
                  <button type="button" class="modal-close" data-dismiss="modal" aria-label="Fechar">
                      <svg viewBox="0 0 24 24" class="icon">
                          <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                      </svg>
                  </button>
              </div>
              <div class="modal-body">
                  <!-- Nome -->
                  <div class="form-group">
                      <label for="editIaName{{ ia.id }}">Nome</label>
                      <input type="text" class="form-input" id="editIaName{{ ia.id }}" name="name" value="{{ ia.name }}" disabled>
                  </div>
                  <!-- Telefone -->
                  <div class="form-group">
                      <label for="editIaPhone{{ ia.id }}">Telefone</label>
                      <input type="text" class="form-input" id="editIaPhone{{ ia.id }}" name="phone_number" value="{{ ia.phone_number }}" required>
                  </div>
                  <!-- Status com Radio Buttons -->
                  <div class="form-group">
                      <label>Ativar/Inativar IA</label>
                      <div class="radio-group">
                          <label class="radio-label">
                              <input type="radio" name="status" id="statusTrue{{ ia.id }}" value="True" {% if ia.status %}checked{% endif %}>
                              <span class="radio-text">Ativo</span>
                          </label>
                          <label class="radio-label">
                              <input type="radio" name="status" id="statusFalse{{ ia.id }}" value="False" {% if not ia.status %}checked{% endif %}>
                              <span class="radio-text">Inativo</span>
                          </label>
                      </div>
                  </div>
                  
                  <!-- Configurações da IA -->
                  <div class="config-card">
                      <div class="config-card-header">
                          <svg class="icon" viewBox="0 0 24 24">
                              <path fill="currentColor" d="M21,15.61L19.59,17L14.58,12L19.59,7L21,8.39L17.44,12L21,15.61M3,6H16V8H3V6M3,13V11H13V13H3M3,18V16H16V18H3Z" />
                          </svg>
                          <h4>Configurações da IA</h4>
                      </div>
                      <div class="config-card-body">
                          <!-- Modelo a ser usado -->
                          <div class="form-group">
                              <label for="editIaModel{{ ia.id }}">Modelo a ser usado</label>
                              <select class="form-select" id="editIaModel{{ ia.id }}" name="model" required>
                                  <option value="gpt-4o" {% if ia.configs and ia.configs[0].credentials.ai_model == "gpt-4o" %}selected{% endif %}>GPT-4o</option>
                                  <option value="gpt-4o-mini" {% if ia.configs and ia.configs[0].credentials.ai_model == "gpt-4o-mini" %}selected{% endif %}>GPT-4o Mini</option>
                              </select>
                          </div>
                          <!-- API Key -->
                          <div class="form-group">
                              <label for="editIaApikey{{ ia.id }}">API Key</label>
                              <input type="text" class="form-input" id="editIaApikey{{ ia.id }}" name="apikey" value="{% if ia.configs %}{{ia.configs[0].credentials.api_key}}{% endif %}" required>
                          </div>
                      </div>
                  </div>
                  
                  <!-- Configurações de Áudio -->
                  <div class="config-card">
                      <div class="config-card-header">
                          <svg class="icon" viewBox="0 0 24 24">
                              <path fill="currentColor" d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
                          </svg>
                          <h4>Configurações de envio de Áudio</h4>
                      </div>
                      <div class="config-card-body">
                          <!-- Probabilidade de Áudio -->
                          <div class="form-group">
                              <label for="editIaAudioProb{{ ia.id }}">Probabilidade de Áudio</label>
                              <div class="range-container">
                                  <input type="range" class="range-input" id="editIaAudioProb{{ ia.id }}" name="probabilidade_audio" min="0" max="100" value="{% if ia.configs %}{{ ia.configs[0].probabilidade_audio|default(0) }}{% else %}0{% endif %}" oninput="updateAudioProbValue{{ ia.id }}(this.value)">
                                  <div class="range-value">
                                      <span id="audioProbValue{{ ia.id }}">{% if ia.configs %}{{ ia.configs[0].probabilidade_audio|default(0)|int }}{% else %}0{% endif %}</span>%
                                  </div>
                              </div>
                          </div>
                          
                          <!-- Campos ElevenLabs -->
                          <div id="elevenLabsFields{{ ia.id }}" class="elevenlabs-fields">
                              <div class="form-row">
                                  <div class="form-group form-group-half">
                                      <label for="editIaElevenApiKey{{ ia.id }}">ElevenLabs API Key</label>
                                      <input type="text" class="form-input" id="editIaElevenApiKey{{ ia.id }}" name="eleven_api_key" value="{% if ia.configs %}{{ ia.configs[0].audio_config.api_key_elevenlabs|default('') }}{% endif %}">
                                  </div>
                                  <div class="form-group form-group-half">
                                      <label for="editIaElevenVoiceId{{ ia.id }}">ElevenLabs Voice ID</label>
                                      <input type="text" class="form-input" id="editIaElevenVoiceId{{ ia.id }}" name="eleven_voice_id" value="{% if ia.configs %}{{ ia.configs[0].audio_config.audio_id|default('') }}{% endif %}">
                                  </div>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="modal-footer">
                  <button type="button" class="btn-secondary" data-dismiss="modal">Fechar</button>
                  <button type="submit" class="btn-primary">Atualizar</button>
              </div>
          </form>
      </div>
  </div>
</div>

    <!-- Modal para Deletar IA -->
    <div class="modal-overlay" id="deleteIAModal{{ ia.id }}" tabindex="-1" aria-labelledby="deleteIAModalLabel{{ ia.id }}" aria-hidden="true">
        <div class="modal-container modal-sm">
            <div class="modal-content">
                <form action="/delete-ia/{{ ia.id }}" method="POST">
                    <div class="modal-header">
                        <h3 class="modal-title" id="deleteIAModalLabel{{ ia.id }}">Confirmar Exclusão</h3>
                        <button type="button" class="modal-close" data-dismiss="modal" aria-label="Fechar">
                            <svg viewBox="0 0 24 24" class="icon">
                                <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                            </svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning">
                            <p>Tem certeza que deseja excluir a IA <strong>{{ ia.name }}</strong>?</p>
                            <p class="alert-small">Esta ação não pode ser desfeita.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="submit" class="btn-danger">Excluir</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para exibição do prompt -->
    <div class="modal-overlay" id="promptModal{{ ia.id }}" tabindex="-1" aria-labelledby="promptModalLabel{{ ia.id }}" aria-hidden="true">
        <div class="modal-container modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="promptModalLabel{{ ia.id }}">Prompt Atual - {{ ia.name }}</h3>
                    <button type="button" class="modal-close" data-dismiss="modal" aria-label="Fechar">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    {% for prompt in ia.prompts %}
                    <div class="prompt-container">
                        <textarea class="prompt-textarea" rows="10" readonly>{{ prompt.text }}</textarea>
                    </div>
                    {% endfor %}
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Conexão -->
    <div class="modal-overlay" id="connectModal{{ ia.id }}" tabindex="-1" aria-labelledby="connectModalLabel{{ ia.id }}" aria-hidden="true">
        <div class="modal-container">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="connectModalLabel{{ ia.id }}">Conectar - {{ ia.name }}</h3>
                    <button type="button" class="modal-close" data-dismiss="modal" aria-label="Fechar">
                        <svg viewBox="0 0 24 24" class="icon">
                            <path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" />
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="qrcode-container">
                        <div id="qrcode{{ ia.id }}" class="qrcode-display">
                            <!-- QR code será carregado aqui -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-dismiss="modal">Fechar</button>
                    <button type="button" class="btn-success" onclick="window.location.reload()">Já Conectei</button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
</div>
{% endif %}

<style>
    :root {
        --primary: #255267;
        --primary-dark: #1e4252;
        --primary-light: #3a6a80;
        --success: #28a745;
        --success-dark: #218838;
        --danger: #dc3545;
        --danger-dark: #c82333;
        --warning: #ffc107;
        --warning-dark: #e0a800;
        --secondary: #6c757d;
        --secondary-dark: #5a6268;
        --background: #ffffff;
        --text: #333333;
        --text-light: #6c757d;
        --border: #e1e4e8;
        --border-light: #f1f3f5;
        --shadow: rgba(0, 0, 0, 0.1);
    }

    /* Reset & Base Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    

    /* Estilos para o estado vazio com animação 3D */
.empty-ia-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 3rem 2rem;
  text-align: center;
  background-color: var(--background);
  border-radius: 1rem;
  border: 1px solid var(--border-light);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  max-width: 800px;
  margin: 2rem auto;
}

.empty-ia-state h2 {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--primary);
  margin: 1.5rem 0 0.5rem;
}

.empty-ia-state p {
  font-size: 1rem;
  color: var(--text-light);
  margin-bottom: 2rem;
  max-width: 500px;
}

/* Modelo 3D e animação */
.model-container {
  position: relative;
  width: 200px;
  height: 200px;
  margin-bottom: 1rem;
  perspective: 800px;
}

.robot-model {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  transform-style: preserve-3d;
  animation: float 6s ease-in-out infinite;
}

.robot-icon {
  position: relative;
  color: var(--primary);
  transform-style: preserve-3d;
  animation: rotate 12s linear infinite;
}

.shadow-element {
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  width: 80px;
  height: 10px;
  background-color: rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  filter: blur(5px);
  animation: shadow-pulse 6s ease-in-out infinite;
}

/* Botão de adicionar */
.btn-add {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  border-radius: 0.5rem;
  font-weight: 500;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
  outline: none;
  background-color: var(--primary);
  color: white;
  box-shadow: 0 4px 6px rgba(37, 82, 103, 0.2);
  margin-bottom: 2.5rem;
}

.btn-add:hover {
  background-color: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 6px 8px rgba(37, 82, 103, 0.25);
}

.btn-add:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(37, 82, 103, 0.2);
}

/* Grade de recursos */
.features-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1.5rem;
  width: 100%;
  margin-top: 1rem;
}

.feature-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  padding: 1.5rem 1rem;
  border-radius: 0.75rem;
  background-color: var(--background-light);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.feature-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.08);
}

.feature-icon {
  width: 48px;
  height: 48px;
  color: var(--primary);
  margin-bottom: 1rem;
}

.feature-item h3 {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 0.5rem;
}

.feature-item p {
  font-size: 0.875rem;
  color: var(--text-light);
  margin: 0;
}

/* Animações */
@keyframes float {
  0% {
      transform: translateY(0px) rotateX(0deg);
  }
  50% {
      transform: translateY(-15px) rotateX(5deg);
  }
  100% {
      transform: translateY(0px) rotateX(0deg);
  }
}

@keyframes rotate {
  0% {
      transform: rotateY(0deg);
  }
  100% {
      transform: rotateY(360deg);
  }
}

@keyframes shadow-pulse {
  0% {
      opacity: 0.3;
      transform: translateX(-50%) scale(0.8);
  }
  50% {
      opacity: 0.5;
      transform: translateX(-50%) scale(1);
  }
  100% {
      opacity: 0.3;
      transform: translateX(-50%) scale(0.8);
  }
}

/* Responsividade */
@media (max-width: 768px) {
  .features-grid {
      grid-template-columns: 1fr;
  }
  
  .empty-ia-state {
      padding: 2rem 1rem;
  }
}

@media (min-width: 769px) and (max-width: 1024px) {
  .features-grid {
      grid-template-columns: repeat(2, 1fr);
  }
}

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--text);
        background-color: #f8f9fa;
    }

    /* Dashboard Header */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .dashboard-header h1 {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
    }

    /* Button Styles */
    .btn-add, .btn-action, .btn-primary, .btn-secondary, .btn-danger, .btn-success {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
        border: none;
        outline: none;
        text-decoration: none;
    }

    .btn-add {
        background-color: var(--success);
        color: white;
    }

    .btn-add:hover {
        background-color: var(--success-dark);
        transform: translateY(-1px);
        box-shadow: 0 2px 5px var(--shadow);
    }

    .btn-primary {
        background-color: var(--primary);
        color: white;
    }

    .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-1px);
        box-shadow: 0 2px 5px var(--shadow);
    }

    .btn-secondary {
        background-color: var(--secondary);
        color: white;
    }

    .btn-secondary:hover {
        background-color: var(--secondary-dark);
    }

    .btn-danger {
        background-color: var(--danger);
        color: white;
    }

    .btn-danger:hover {
        background-color: var(--danger-dark);
    }

    .btn-success {
        background-color: var(--success);
        color: white;
    }

    .btn-success:hover {
        background-color: var(--success-dark);
    }

    .btn-action {
        background-color: var(--primary);
        color: white;
        width: 100%;
        padding: 0.625rem;
    }

    .btn-action:hover {
        background-color: var(--primary-dark);
    }

    .btn-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2rem;
        height: 2rem;
        border-radius: 0.375rem;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        background-color: transparent;
    }

    .btn-connect {
        color: var(--primary);
    }

    .btn-connect:hover {
        background-color: rgba(37, 82, 103, 0.1);
    }

    .btn-edit {
        color: var(--warning);
    }

    .btn-edit:hover {
        background-color: rgba(255, 193, 7, 0.1);
    }

    .btn-delete {
        color: var(--danger);
    }

    

    .btn-delete:hover {
        background-color: rgba(220, 53, 69, 0.1);
    }

    /* Icon */
    .icon {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
    }

    /* Card Grid */
    .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    /* Card Styles */
    .card {
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 2px 8px var(--shadow);
        overflow: hidden;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .card-header {
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid var(--border-light);
    }

    .card-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 70%;
    }

    .card-actions {
        display: flex;
        gap: 0.25rem;
    }

    .card-body {
        padding: 1rem;
    }

    .card-info {
        margin-bottom: 1rem;
    }

    .info-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .info-label {
        font-weight: 500;
        color: var(--text-light);
    }

    .info-value {
        font-weight: 500;
    }

    /* Layout para campos em linha */
    .form-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
  }
  
  .form-group-half {
      flex: 1;
      min-width: 200px;
  }
  
  /* Estilos para inputs desabilitados */
  .form-input:disabled {
      background-color: var(--background-light);
      opacity: 0.7;
      cursor: not-allowed;
  }
      /* Estilos adicionais para os cards de configuração */
      .config-card {
        border: 1px solid var(--border);
        border-radius: 0.5rem;
        margin-bottom: 1.5rem;
        overflow: hidden;
        background-color: var(--background-light);
    }
    
    .config-card-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background-color: var(--primary);
        color: white;
        font-weight: 500;
    }
    
    .config-card-header h4 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
    }
    
    .config-card-body {
        padding: 1rem;
    }

    /* Estilos para o range slider */
    .range-container {
      display: flex;
      align-items: center;
      gap: 1rem;
  }
  
  .range-input {
      flex: 1;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
      background: var(--border);
      border-radius: 3px;
      outline: none;
  }
  
  .range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      transition: background 0.2s ease;
  }
  
  .range-input::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border: none;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
      transition: background 0.2s ease;
  }
  
  .range-input::-webkit-slider-thumb:hover {
      background: var(--primary-dark);
  }
  
  .range-input::-moz-range-thumb:hover {
      background: var(--primary-dark);
  }
  
  .range-value {
      min-width: 3rem;
      text-align: center;
      font-weight: 600;
      color: var(--primary);
      font-size: 0.875rem;
  }

    .status-badge {
        padding: 0.25rem 0.5rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .status-active {
        background-color: rgba(40, 167, 69, 0.1);
        color: var(--success);
    }

    .status-inactive {
        background-color: rgba(108, 117, 125, 0.1);
        color: var(--secondary);
    }

    .card-buttons {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
    }

    /* Modal Styles */
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        overflow-y: auto;
        padding: 2rem 1rem;
        align-items: center;
        justify-content: center;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .modal-overlay.show {
        opacity: 1;
        visibility: visible;
        display: flex;
    }

    .modal-container {
        width: 100%;
        max-width: 500px;
        margin: auto;
        background-color: white;
        border-radius: 0.5rem;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(-20px);
        transition: transform 0.3s ease;
    }

    .modal-overlay.show .modal-container {
        transform: translateY(0);
    }

    .modal-lg {
        max-width: 700px;
    }

    .modal-sm {
        max-width: 400px;
    }

    .modal-content {
        display: flex;
        flex-direction: column;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        border-bottom: 1px solid var(--border);
    }

    .modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0;
    }

    .modal-close {
        background: transparent;
        border: none;
        cursor: pointer;
        color: var(--text-light);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        transition: background-color 0.2s ease;
    }

    .modal-close:hover {
        background-color: var(--border-light);
        color: var(--text);
    }

    .modal-body {
        padding: 1rem;
        overflow-y: auto;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 0.75rem;
        padding: 1rem;
        border-top: 1px solid var(--border);
    }

    /* Form Styles */
    .form-group {
        margin-bottom: 1rem;
    }

    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: var(--text);
    }

    .form-input, .form-select {
        width: 100%;
        padding: 0.625rem;
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        font-size: 0.875rem;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .form-input:focus, .form-select:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(37, 82, 103, 0.1);
        outline: none;
    }

    .radio-group {
        display: flex;
        gap: 1.5rem;
    }

    .radio-label {
        display: flex;
        align-items: center;
        cursor: pointer;
    }

    .radio-label input {
        margin-right: 0.5rem;
    }

    /* QR Code Container */
    .qrcode-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 1rem;
    }

    .qrcode-display {
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .qrcode-display img {
        max-width: 100%;
        border: 1px solid var(--border);
        border-radius: 0.5rem;
    }

    /* Prompt Textarea */
    .prompt-container {
        border: 1px solid var(--border);
        border-radius: 0.375rem;
        overflow: hidden;
    }

    .prompt-textarea {
        width: 100%;
        padding: 0.75rem;
        border: none;
        font-family: monospace;
        font-size: 0.875rem;
        resize: vertical;
        background-color: #f8f9fa;
    }

    /* Alert Styles */
    .alert {
        padding: 1rem;
        border-radius: 0.375rem;
        margin-bottom: 1rem;
    }

    .alert-warning {
        background-color: rgba(255, 193, 7, 0.1);
        border-left: 4px solid var(--warning);
    }

    .alert-danger {
        background-color: rgba(220, 53, 69, 0.1);
        border-left: 4px solid var(--danger);
    }

    .alert-small {
        font-size: 0.875rem;
        margin-top: 0.5rem;
        color: var(--text-light);
    }

    /* Spinner for Loading */
    .spinner-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
    }

    .spinner-border {
        display: inline-block;
        width: 2rem;
        height: 2rem;
        border: 0.25rem solid var(--primary);
        border-right-color: transparent;
        border-radius: 50%;
        animation: spinner 0.75s linear infinite;
    }

    @keyframes spinner {
        to {
            transform: rotate(360deg);
        }
    }

    /* Responsive Styles */
    @media (max-width: 768px) {
        .card-grid {
            grid-template-columns: 1fr;
        }
        
        .dashboard-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .dashboard-header h1 {
            margin-bottom: 0.5rem;
        }
        
        .btn-add {
            width: 100%;
        }
    }
</style>

<script>
  
    // Definindo host_evo e api_key globais para uso nas funções
    const host_evo = "{{ host_evo }}";
    const api_key = "{{ api_key }}";
    
    // Sistema de Modal Personalizado
    document.addEventListener('DOMContentLoaded', function() {
        // Função para abrir modal
        window.openModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Previne rolagem do body
            
            // Adiciona classe para animação
            setTimeout(() => {
                modal.classList.add('show');
            }, 10);
            
            // Foca no primeiro elemento focável dentro do modal
            const focusableElements = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
            if (focusableElements.length) {
                focusableElements[0].focus();
            }
        };
        
        // Função para fechar modal
        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            
            modal.classList.remove('show');
            
            // Espera a animação terminar antes de esconder
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = ''; // Restaura rolagem do body
            }, 300);
        };
        
        // Fecha modal ao clicar no backdrop
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });
        
        // Fecha modal ao pressionar ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const openModal = document.querySelector('.modal-overlay.show');
                if (openModal) {
                    closeModal(openModal.id);
                }
            }
        });
        
        // Adiciona event listeners para todos os botões que abrem modais
        document.querySelectorAll('[data-toggle="modal"]').forEach(button => {
            const targetId = button.getAttribute('data-target').substring(1); // Remove o # do início
            button.addEventListener('click', function(event) {
                event.preventDefault();
                openModal(targetId);
            });
        });
        
        // Adiciona event listeners para todos os botões que fecham modais
        document.querySelectorAll('[data-dismiss="modal"]').forEach(button => {
            button.addEventListener('click', function() {
                const modal = this.closest('.modal-overlay');
                if (modal) {
                    closeModal(modal.id);
                }
            });
        });
    });
    const current_user_id = {{ current_user.id }};
    // Função para carregar QR code
    function loadQRCode(iaId, iaName, logout) {
        
      if (logout == true) {
        const url = `${host_evo}instance/logout/${iaName}_${current_user_id}`;
        fetch(url, {
          method: 'DELETE',
          headers: {
            'apikey': `${api_key}`,
            'Content-Type': 'application/json'
          }
        })
        .then(response => {

          if (!response.ok) {
            throw new Error('Erro na requisição: ' + response.status);
          }
          return response.json();
        })
    }
        
        // Abre o modal primeiro
        openModal(`connectModal${iaId}`);
        
        // Mostrar loading
        const qrcodeElement = document.getElementById(`qrcode${iaId}`);
        if (!qrcodeElement) {
            console.error('Elemento qrcode não encontrado para ID:', iaId);
            return;
        }
        
        qrcodeElement.innerHTML = `
            <div class="spinner-container">
                <div class="spinner-border" role="status">
                    <span class="sr-only"></span>
                </div>
            </div>
        `;
        
        // Montando a URL completa
        const url = `${host_evo}instance/connect/${iaName}_${current_user_id}`;
        
        // Fazendo a requisição para a API
        fetch(url, {
            method: 'GET',
            headers: {
                'apikey': `${api_key}`,
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            console.log('Resposta recebida:', response.status);
            if (!response.ok) {
                throw new Error('Erro na requisição: ' + response.status + response);
            }
            return response.json();
        })
        .then(data => {
            console.log('Dados recebidos:', data);
            if (data.base64) {
                // Exibindo o QR code
                qrcodeElement.innerHTML = `<img src="${data.base64}" class="img-fluid" alt="QR Code">`;
                
                // Notificação de sucesso (se estiver usando Toastify)
                if (typeof Toastify !== 'undefined') {
                    Toastify({
                        text: "QR Code gerado com sucesso!",
                        duration: 3000,
                        close: true,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "#28a745",
                    }).showToast();
                }
            } else if (data.count !== undefined) {
                // Caso específico quando recebemos apenas o campo count
                qrcodeElement.innerHTML = `
                    <div class="alert alert-warning" role="alert">
                        <p>Aguardando geração do QR Code. Por favor, tente novamente em alguns instantes.</p>
                    </div>
                `;
            } else if (data.state !== "open") {
              // Caso específico quando recebemos apenas o campo count
              qrcodeElement.innerHTML = `
                  <div class="alert alert-warning" role="alert">
                      <p>Número já conectado Deseja efetuar logout?</p>
                       <div class="mt-5">
                  <button class="btn btn-danger btn-sm" onclick="loadQRCode('${iaId}', '${iaName}', true)">Sim, trocar</button>
                  
                  </div>
                  </div>
                 
              `;
          } else {
                throw new Error('Dados do QR Code não disponíveis');
            }
        })
        .catch(error => {
            console.error('Erro ao carregar QR code:', error);
            qrcodeElement.innerHTML = `
                <div class="alert alert-danger" role="alert">
                    <p>Erro ao gerar QR Code. Por favor, tente novamente.</p>
                </div>
            `;
            
            // Notificação de erro (se estiver usando Toastify)
            if (typeof Toastify !== 'undefined') {
                Toastify({
                    text: "Erro ao gerar QR Code",
                    duration: 3000,
                    close: true,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "#dc3545",
                }).showToast();
            }
        });
    }
</script>
{% endblock %}